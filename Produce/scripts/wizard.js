var wiz=new function(){'use strict';var _this=this,timerIdentifier,waitTimerIdentifier,hoverTimerIdentifier,previousPageListJson,logoutTimerIdentifier,logoutTimeoutPeriod,liveRefreshTimerIdentifier,liveRefreshPeriod,postUpdateCall=null,defaultButtonOverride,helpButton=null,previousPage,previousRepeat,postDataCapture;this.formIsDirty=false;this.overridePostback=false;this.pushingState=true;this.lastFocusedControlId='';this.pageListJson='';this.hasValidationChanged=false;this.stateCustomUI='';this.pgReloaded=false;this.tileDict={};this.isCapturingData=false;this.capturedDataNodes=[];this.dataNode={};this.intervalId='';this.attachedEvents=".form-control, .help-question, .analyticslog, .commentsIcon, input[type=radio], input[type=checkbox], input[type=button]";this.capturePath='';this.intervals=[];this.removeAt=function removeAt(arr,from,to){var rest=arr.slice((to||from)+1||arr.length);arr.length=from<0?arr.length+from:from;arr.push.apply(arr,rest)};this.indexOf=function indexOf(arr,obj){var l=arr.length,i=0;for(i=0;i<l;i++){if(i in arr&&arr[i]===obj){return i}}return-1};var doKeepAlive=function doKeepAlive(logGuid){$.ajaxSetup({cache:false});$.get($('#baseUrl').val()+'Wizard/KeepAlive/'+logGuid)};this.dataCaptureInit=function dataCaptureInit(path){_this.isCapturingData=true;_this.initDataCaptureListeners(path);_this.capturePath=path;if(!_this.intervalId){_this.intervalId=setInterval(function(){wiz.postDataCapture(false)},10000)}};this.initDataCaptureListeners=function initDataCaptureListeners(path){var logGuid=$('#hidLogGuid').val();$('#up '+_this.attachedEvents).each(function(){$(this).on('blur',function(e){_this.dataAnalyticsBlur()});$(this).on('focus',function(e){var focusNode=$(this).data('analyticsid');var eventNode=$(this).data('analyticsevent');if(_this.dataNode&&focusNode===_this.dataNode.controlID){}_this.dataAnalyticsFocus(focusNode,eventNode)})});$('#up input[type=submit]').each(function(){$(this).on('click',function(e){var focusNode=$(this).data('analyticsid');var eventNode=$(this).data('analyticsevent');_this.dataAnalyticsFocusAndBlur(focusNode,eventNode)})});$('#up .analyticslogdd').each(function(){$(this).on('change',function(e){var focusNode=$(this).find(':selected').data('analyticsid');var eventNode=$(this).data('analyticsevent');_this.dataAnalyticsFocus(focusNode);_this.dataAnalyticsBlur()})})};this.removeDataCaptureListeners=function removeDataCaptureListeners(){$('#up '+_this.attachedEvents).each(function(){$(this).off('blur');$(this).off('focus')});$('#up input[type=submit]').each(function(){$(this).off('click')})};function dataCopyNode(logGuid,controlID,eventType,focusTimeUtc,blurTimeUtc,pageTitle){this.logGuid=logGuid;this.controlID=controlID;this.eventType=eventType;this.focusTimeUtc=focusTimeUtc;this.blurTimeUtc=blurTimeUtc;this.pageTitle=pageTitle}this.dataAnalyticsFocus=function dataAnalyticsFocus(controlID,eventType){if(eventType==null){eventType=''}_this.dataNode={logGuid:$('#hidLogGuid').val(),controlID:controlID,eventType:eventType,focusTimeUtc:this.getUTCNowISOString(),blurTimeUtc:'',pageTitle:$('#page-title').text()}};this.dataAnalyticsBlur=function dataAnalyticsBlur(){if(_this.dataNode&&!_this.dataNode.blurTimeUtc&&_this.dataNode.controlID){_this.dataNode.blurTimeUtc=this.getUTCNowISOString();;_this.capturedDataNodes.push(new dataCopyNode(_this.dataNode.logGuid,_this.dataNode.controlID,_this.dataNode.eventType,_this.dataNode.focusTimeUtc,_this.dataNode.blurTimeUtc,_this.dataNode.pageTitle));_this.dataNode={}}};this.getUTCNowISOString=function getUTCNowISOString(){return((new Date).toISOString())};this.dataAnalyticsFocusAndBlur=function dataAnalyticsFocusAndBlur(controlID,eventType){if(eventType==null){eventType=''}var logGuid=$('#hidLogGuid').val();_this.dataAnalyticsFocus(controlID,eventType);_this.dataAnalyticsBlur()};this.postDataCapture=function postDataCapture(force){if(_this.capturedDataNodes&&_this.capturedDataNodes.length>0){var uri=_this.capturePath+'wizard/datacapture/';var stringifyData=JSON.stringify({dataNodes:_this.capturedDataNodes});$.ajax({type:'POST',url:uri,data:stringifyData,async:force?false:true,contentType:'application/json',error:function(xhr,status,error){},success:function(response,status,xhr){}})}_this.capturedDataNodes.length=0};var doLogOut=function doLogOut(){_this.formIsDirty=false;window.location=$('#logUrl').val()};var doLiveRefresh=function doLiveRefresh(){preventUserInput();_this.doAjaxPost($('#reloadPageUrl').val()+'&liveRefresh=true')};var showHelpResult=function showHelpResult(json,showClose){var pos=$(helpButton).offset(),scrollTop=$('.wizardContent').scrollTop(),scrollLeft=$('.wizardContent').scrollLeft(),left=scrollLeft+pos.left-315;if(left<0){left=0}if(showClose){$('#closeHelp').show()}else{$('#closeHelp').hide()}$('#HelpText').css({left:left+'px',top:pos.top+scrollTop+'px'});$('#HelpText').children('span').html(json);$('#HelpText').show();$('#HelpText').focus()};var saveProgress=function saveProgress(description){document.getElementById('hidSaveDescription').value=description;var url=$('#saveActionUrl').val()+addLatLonQueryString();_this.doAjaxPost(url)};var restoreFocus=function restoreFocus(){if(!(_this.lastFocusedControlId==null||_this.lastFocusedControlId===''||_this.lastFocusedControlId==='QuestionsInner')){var ctl=$('#'+_this.lastFocusedControlId);if(ctl.length>0&&ctl.is(':disabled')===false){ctl.focus();if(_this.isCapturingData){_this.dataNode={}}}}};var updatePlaceholder=function updatePlaceholder(html){$('#up').html(html);setTimeout(restoreFocus,100)};var updateError=function updateError(text){document.write(text)};var clearTimers=function clearTimers(){clearTimeout(timerIdentifier);clearTimeout(logoutTimerIdentifier);clearTimeout(liveRefreshTimerIdentifier);for(var i=0;i<_this.intervals.length;i++){clearTimeout(_this.intervals[i])}_this.intervals=[]};var saveFocus=function saveFocus(){var ctl=$('*:focus');if(ctl.length>0){_this.lastFocusedControlId=ctl.prop('id')}else{_this.lastFocusedControlId=''}};var openWaitDialog=function openWaitDialog(){_this.clearWaitTimer();waitTimerIdentifier=setTimeout(_this.waitDialogTimerExpired,1000)};var beforeSubmit=function beforeSubmit(){var id;clearTimers();saveFocus();openWaitDialog();try{for(var i=tinyMCE.editors.length-1;i>=0;i--){id=tinyMCE.editors[i].id;tinyMCE.editors[i].remove();$('#'+id).hide()}}catch(ignore){tinyMCE.editors=[]}if($('#ui-datepicker-div').is(':visible')){$('#ui-datepicker-div').hide()}};function setInkValue(element){var canvas=element,canvasId=$(element).prop('id'),data='',ctx=canvas.getContext('2d'),drawn=false,d=ctx.getImageData(0,0,canvas.width,canvas.height),len=d.data.length;var valueContainer=$('#'+(canvasId.substring(0,canvasId.length-2)));var originalWidth=valueContainer.data('bk-width');var scaleRatio=originalWidth/canvas.width;for(var pixel=0;pixel<len;pixel++){if(d.data[pixel]){drawn=true;break}}if(drawn){var imgObj=new Image;imgObj.onload=function(){var newCanvas=$("<canvas>").prop("width",d.width*scaleRatio).prop("height",d.height*scaleRatio)[0];newCanvas.getContext("2d").drawImage(imgObj,0,0,d.width*scaleRatio,d.height*scaleRatio);data=newCanvas.toDataURL().replace('data:image/png;base64,','');valueContainer.val(data)};imgObj.src=element.toDataURL()}else{valueContainer.val(data)}}var updateSort=function updateSort(event,ui){document.getElementById('custAction').value=ui.item.parent().data('pageindex')+'_'+ui.item.data('index')+'_'+ui.item.index();setTimeout(function(){wiz.doAjaxPost($('#changeSortUrl').val())})};var updateSortRow=function updateSortRow(event,ui){var moveToIndex=ui.item.index();if(moveToIndex!==0){if(ui.item.parent().children()[moveToIndex-1].getAttribute('data-index')>ui.item.data('index')){moveToIndex=ui.item.parent().children()[moveToIndex-1].getAttribute('data-index')}else{if(ui.item.parent().children()[moveToIndex+1].getAttribute('class')!='lsrepeat-spacer'){moveToIndex=ui.item.parent().children()[moveToIndex+1].getAttribute('data-index')}else{moveToIndex=ui.item.parent().children()[moveToIndex+2].getAttribute('data-index')}}}document.getElementById('custAction').value=ui.item.parent().data('objectid')+'_'+ui.item.parent().data('repeatpath')+'_'+ui.item.data('index')+'_'+moveToIndex+'_'+ui.item.parent().data('fragmentguid');setTimeout(function(){wiz.doAjaxPost($('#changeSortUrl').val())})};var addHistory=function addHistory(){var currentPage=$('#hidCurrentPage').val(),currentRepeat=$('#hidCurrentRepeat').val();if(previousPage!=currentPage||previousRepeat!=currentRepeat){previousPage=currentPage;previousRepeat=currentRepeat;if(window.History){History.pushState({p:currentPage,r:currentRepeat},null,null)}}return true};this.commentsPopup=function(sender,qid){var iframe=$('<iframe width="100%" height="450px" frameborder="0" />');$('.modal-lgd-insert').html('').append(iframe);$('#popupLargeDraggableModal').modal({keyboard:false});$('#draggableDialog').draggable();iframe.prop('src',$(sender).data('path')+'wizard/commentspopupwindow/'+$(sender).data('questionguid')+'?LogGuid='+$(sender).data('log')+'&FragmentGuid='+$(sender).data('frag')+'&RepeatPath='+$(sender).data('repeatpath')+'&Qid='+qid+'&UserGuid='+$(sender).data('userguid'));$('#up').attr("aria-hidden","true");$('#popupLargeDraggableModal').modal('show')};this.zoomIn=function(sender,qid){var iframe=$('<iframe id="zoomInFrame" width="'+((window.innerWidth*.965)-8)+'px" height="'+((window.innerHeight*.97)-8)+'px" scrolling="no" style="overflow:hidden" frameborder="0" padding="0" />');$('.modal-lgf-insert').html('').append(iframe);$('#popupFullscreenModal').modal({keyboard:false});iframe.prop('src',$(sender).data('path')+'wizard/zoomedininkwindow/'+$(sender).data('questionguid')+'?LogGuid='+$(sender).data('log')+'&FragmentGuid='+$(sender).data('frag')+'&RepeatPath='+$(sender).data('repeatpath')+'&Qid='+qid+'&UserGuid='+$(sender).data('userguid'));$('#up').attr("aria-hidden","true");$('#popupFullscreenModal').modal('show')};this.commentKeep=function(sender,commentId,popup){var location=popup.location.search;var uri=popup.location.href;uri=uri.split('#')[0];uri=uri.split('?')[0];var questionGuid=uri.substring(uri.lastIndexOf('/')+1);$.ajax({type:"GET",url:$(sender).data('path')+'wizard/commentkeep/'+questionGuid+"?LogGuid="+this.getParameterByName("LogGuid",location)+"&CommentId="+commentId+"&FragmentGuid="+this.getParameterByName("FragmentGuid",location)+"&RepeatPath="+this.getParameterByName("RepeatPath",location),success:function(json){$(sender).hide();$(popup.document).find("#"+$(sender).data("alt-id")).show()}})};this.commentViewUpdate=function(questionGuid,datapath,location){var uri=datapath+'wizard/commentviewupdate/'+questionGuid+"?LogGuid="+this.getParameterByName("LogGuid",location)+"&FragmentGuid="+this.getParameterByName("FragmentGuid",location)+"&RepeatPath="+this.getParameterByName("RepeatPath",location)+"&UserGuid="+this.getParameterByName("UserGuid",location);$.ajax({type:"GET",url:uri,success:function(json){}})};this.getParameterByName=function(name,location){if(location==null){location=window.location.search}var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(location);if(results==null){return""}else{return decodeURIComponent(results[1].replace(/\+/g," "))}};var attachHelpText=function attachHelpText(){$(".help-question").click(function(){var link=$(this);wiz.showHelp(link.data('path'),this,link.data('questionguid'),link.data('log'),link.data('frag'),link.data('repeatpath'),true);return false}).mouseover(function(){var link=$(this);wiz.delayShowHelp(link.data('path'),this,link.data('questionguid'),link.data('log'),link.data('frag'),link.data('repeatpath'))}).mouseout(function(){wiz.cancelHelp()});$(".help-object").click(function(){var link=$(this);wiz.showObjectHelp(link.data('path'),this,link.data('objectid'),link.data('log'),true);return false}).mouseover(function(){var link=$(this);wiz.delayShowObjectHelp(link.data('path'),this,link.data('objectid'),link.data('log'))}).mouseout(function(){wiz.cancelHelp()})};this.keepAlive=function keepAlive(logGuid,timeoutPeriod){logoutTimeoutPeriod=-1;setInterval(function(){doKeepAlive(logGuid)},timeoutPeriod)};this.logOut=function logOut(timeoutPeriod){logoutTimeoutPeriod=timeoutPeriod;logoutTimerIdentifier=setTimeout(doLogOut,logoutTimeoutPeriod)};this.liveRefresh=function liveRefresh(timeoutPeriod){liveRefreshPeriod=timeoutPeriod;liveRefreshTimerIdentifier=setTimeout(doLiveRefresh,timeoutPeriod)};this.showHelp=function showHelp(path,id,questionGuid,logGuid,fragmentGuid,repeatPath,showClose){helpButton=id;$.ajax({type:'POST',url:path+'WizardSupport/GetHelpText',data:"{ 'fragmentGuid': '"+fragmentGuid+"', 'questionGuid': '"+questionGuid+"', 'logGuid': '"+logGuid+"', 'repeatPath': '"+repeatPath+"' }",contentType:'application/json; charset=utf-8',dataType:'json',success:function(json){showHelpResult(json,showClose)}})};this.showObjectHelp=function showObjectHelp(path,id,objectId,logGuid,showClose){helpButton=id;$.ajax({type:'POST',url:path+'WizardSupport/GetObjectHelpText',data:"{'objectId': '"+objectId+"', 'logGuid': '"+logGuid+"'}",contentType:'application/json; charset=utf-8',dataType:'json',success:function(json){showHelpResult(json,showClose)}})};this.delayShowHelp=function delayShowHelp(path,id,questionGuid,logGuid,fragmentGuid,repeatPath){hoverTimerIdentifier=window.setTimeout(function(){if(!$('#closeHelp').is(':visible')){wiz.showHelp(path,id,questionGuid,logGuid,fragmentGuid,repeatPath,false)}},800)};this.delayShowObjectHelp=function delayShowObjectHelp(path,id,objectId,logGuid){hoverTimerIdentifier=window.setTimeout(function(){if(!$('#closeHelp').is(':visible')){wiz.showObjectHelp(path,id,objectId,logGuid,false)}},800)};this.hideHelp=function hideHelp(){$('#HelpText').hide();if(helpButton!==null){$(helpButton).focus();helpButton=null}};this.cancelHelp=function cancelHelp(){window.clearTimeout(hoverTimerIdentifier);hoverTimerIdentifier=null;if(!$('#closeHelp').is(':visible')){_this.hideHelp()}};this.getAddress=function getAddress(path,lst,prefix){$.ajax({type:'POST',url:path+'WizardSupport/GetAddress',data:"{'addressId': '"+$('#'+lst).val()+"'}",contentType:'application/json; charset=utf-8',dataType:'json',success:function(json){document.getElementById(prefix+'chkAddressSave').checked=false;document.getElementById(prefix+'chkAddressSave').disabled=true;document.getElementById(prefix+'rdoExistingAddress').checked=true;document.getElementById(prefix+'Prefix').value=json.Prefix;document.getElementById(prefix+'FirstName').value=json.FirstName;document.getElementById(prefix+'LastName').value=json.LastName;document.getElementById(prefix+'Title').value=json.Title;document.getElementById(prefix+'Organisation').value=json.Organisation;document.getElementById(prefix+'PhoneNumber').value=json.PhoneNumber;document.getElementById(prefix+'FaxNumber').value=json.FaxNumber;document.getElementById(prefix+'EmailAddress').value=json.EmailAddress;document.getElementById(prefix+'StreetAddress1').value=json.StreetAddress.Address1;document.getElementById(prefix+'StreetAddress2').value=json.StreetAddress.Address2;document.getElementById(prefix+'StreetSuburb').value=json.StreetAddress.Suburb;document.getElementById(prefix+'StreetState').value=json.StreetAddress.State;document.getElementById(prefix+'StreetPostCode').value=json.StreetAddress.Postcode;document.getElementById(prefix+'StreetCountry').value=json.StreetAddress.Country;document.getElementById(prefix+'PostalAddress1').value=json.PostalAddress.Address1;document.getElementById(prefix+'PostalAddress2').value=json.PostalAddress.Address2;document.getElementById(prefix+'PostalSuburb').value=json.PostalAddress.Suburb;document.getElementById(prefix+'PostalState').value=json.PostalAddress.State;document.getElementById(prefix+'PostalPostCode').value=json.PostalAddress.Postcode;document.getElementById(prefix+'PostalCountry').value=json.PostalAddress.Country;$('[id^=\"'+prefix+'C\"]').each(function(i){var found=false,field;for(var f in json.CustomFields){if(json.CustomFields.hasOwnProperty(f)){field=json.CustomFields[f];if(field.CustomFieldId==$(this).data('id')){found=true;try{if(this.src&&this.src!='undefined'&&this.src!==''){this.src=this.src.substring(0,this.src.lastIndexOf('DataGuid='))+'DataGuid='+field.Value}else{this.value=field.Value}}catch(ignore){}}}}if(!found){if(this.src&&this.src!='undefined'&&this.src!==''){this.src=this.src.substring(0,this.src.lastIndexOf('DataGuid='))+'DataGuid='}else if($(this).prop('id').indexOf('hidCustomFieldID')===-1){this.value=''}}})}})};this.clearAddress=function clearAddress(prefix){if(document.getElementById(prefix+'chkAddressSave').disabled===true){document.getElementById(prefix+'chkAddressSave').disabled=false;document.getElementById(prefix+'Prefix').value='';document.getElementById(prefix+'FirstName').value='';document.getElementById(prefix+'LastName').value='';document.getElementById(prefix+'Title').value='';document.getElementById(prefix+'Organisation').value='';document.getElementById(prefix+'PhoneNumber').value='';document.getElementById(prefix+'FaxNumber').value='';document.getElementById(prefix+'EmailAddress').value='';document.getElementById(prefix+'StreetAddress1').value='';document.getElementById(prefix+'StreetAddress2').value='';document.getElementById(prefix+'StreetSuburb').value='';document.getElementById(prefix+'StreetState').value='';document.getElementById(prefix+'StreetPostCode').value='';document.getElementById(prefix+'StreetCountry').value='';document.getElementById(prefix+'PostalAddress1').value='';document.getElementById(prefix+'PostalAddress2').value='';document.getElementById(prefix+'PostalSuburb').value='';document.getElementById(prefix+'PostalState').value='';document.getElementById(prefix+'PostalPostCode').value='';document.getElementById(prefix+'PostalCountry').value='';$('[id^=\"'+prefix+'C\"]').each(function(){if($(this).is('img')){var src=$(this).prop('src');$(this).prop('src',src.substring(0,src.lastIndexOf('DataGuid='))+'DataGuid=')}else if($(this).prop('id').indexOf('hidCustomFieldID')===-1){$(this).val('')}})}};this.tabClick=function tabClick(ui,tab){document.getElementById('custAction').value=ui.parent().data('objectid')+'_'+ui.parent().data('repeatpath')+'_'+tab+'_'+ui.parent().data('fragmentguid');_this.doAjaxPost($('#selectTabUrl').val())};this.reload=function reload(restoreFocusTo){if(_this.isCapturingData){window.clearInterval(_this.intervalId);_this.intervalId='';_this.removeDataCaptureListeners()}_this.doAjaxPost($('#reloadPageUrl').val(),null,null,restoreFocusTo)};this.saveProgressDialog=function saveProgressDialog(description){document.getElementById('hidSaveDescription').value=description;var url=$('#saveActionUrl').val()+addLatLonQueryString();_this.closeModal();_this.doAjaxPost(url)};this.reassignDialog=function reassignDialog(email,name,description){document.getElementById('hidReassignEmail').value=email;document.getElementById('hidReassignName').value=name;document.getElementById('hidSaveDescription').value=description;var url=$('#tempUserReassignUrl').val()+addLatLonQueryString();_this.closeModal();_this.doAjaxPost(url)};this.openSave=function openSave(path,logGuid){if(document.getElementById('hidSavedInProgress').value==='00000000-0000-0000-0000-000000000000'){var iframe=$('<iframe width="380px" height="135px" frameborder="0" title="'+$('#savePopupTitle').val()+'"/>');$('.modal-insert').html('').append(iframe);$('#popupModal').modal({keyboard:false});iframe.prop('src',path+'WizardSupport/SavePrompt?LogGuid='+logGuid+addLatLonQueryString());this.showingModal()}else{saveProgress('')}};this.openTempUserSave=function openTempUserSave(path,logGuid){var iframe=$('<iframe width="380px" height="200px" style="padding-top:15px;" frameborder="0" title="'+$('#savePopupTitle').val()+'"/>');$('.modal-insert').html('').append(iframe);$('#popupModal').modal({keyboard:false});iframe.prop('src',path+'WizardSupport/TempUserSavePrompt?LogGuid='+logGuid+addLatLonQueryString());this.showingModal()};this.openReassign=function openReassign(path,queryString){var iframe=$('<iframe width="380px" height="300px" frameborder="0" title="'+$('#reassignPopupTitle').val()+'"/>');$('.modal-insert').html('').append(iframe);$('#popupModal').modal({keyboard:false});var url=path+'WizardSupport/TempUserReassignPrompt?'+addLatLonQueryString();if(queryString!==null&&queryString!==""){url+='&'+queryString}iframe.prop('src',url);this.showingModal()};function addLatLonQueryString(){var latitude=document.getElementById('Latitude').value;if(latitude===null||latitude===""){latitude=parent.document.getElementById('Latitude').value}var longitude=document.getElementById('Longitude').value;if(longitude===null||longitude===""){longitude=parent.document.getElementById('Longitude').value}return'&latitude='+latitude+'&longitude='+longitude}this.openPreview=function openPreview(path,logGuid,queryString){var popup=window.open(path+'Blank.htm','','height=300,width=400');var url=path+'wizardsupport/Preview?logGuid='+logGuid;if(queryString!==null&&queryString!==""){url+='&'+queryString}postUpdateCall=function(){popup.location=url};_this.reload()};this.jumpToGroup=function jumpToGroup(group,repeatIndex){_this.formIsDirty=true;_this.pushingState=true;document.getElementById('hidNextGroup').value=group;document.getElementById('hidNextRepeatIndex').value=repeatIndex;_this.reload()};this.goToPage=function goToPage(pageGuid){_this.formIsDirty=true;_this.pushingState=true;document.getElementById('hidNextGroup').value=pageGuid;document.getElementById('hidNextRepeatIndex').value='0';_this.reload()};this.goToProject=function goToProject(path,projectGroupGuid,portal,portalSave,wizardMode){_this.formIsDirty=false;window.location=path+'Home/GoToProject?projectGroupGuid='+projectGroupGuid+"&logguid="+$('#hidLogGuid').val()+"&portal="+portal+"&portalSave="+portalSave+"&wizardMode="+wizardMode};this.goToLink=function goToLink(path,link){_this.formIsDirty=false;window.location=path+link;addHistory()};this.doAction=function doAction(message,path,link){if(confirm(message)){_this.formIsDirty=false;document.getElementById('actionForm').setAttribute('action',path+link);document.getElementById('actionForm').submit();addHistory()}return false};this.getTileBorderColour=function getTileBorderColour(elementId){var element=document.getElementById(elementId);var colour=$(element).css('border-color');return this.rgbToHex(colour)};this.getTileBackgroundColour=function getTileBackgroundColour(elementId){var element=document.getElementById(elementId);var colour=$(element).css('background-color');return this.rgbToHex(colour)};this.getTileBackgroundGradientColour=function getTileBackgroundGradientColour(elementId){var element=document.getElementById(elementId);var colours=$(element).css('background-image');var gradient="";if(colours.split('0%,').length>1){gradient=colours.split('0%,')[1].replace('100%)','').trim()}return this.rgbToHex(gradient)};this.addValueToTileDictionary=function addValueToTileDictionary(key,value){if(!this.tileDict.hasOwnProperty(key)){this.tileDict[key]=value}};this.getValueFromTileDictionary=function getValueFromTileDictionary(key){if(this.tileDict.hasOwnProperty(key)){return this.tileDict[key]}return''};this.changeTileFocusRing=function changeTileFocusRing(sender,originalBorder,newBorder){if(newBorder!==''){if(this.rgbToHex(sender.style.borderColor)===this.rgbToHex(originalBorder)||sender.style.borderColor===""){sender.style.borderColor=newBorder}else{sender.style.borderColor=originalBorder}}};this.toggleTileBackground=function toggleTileBackground(sender,originalColour,originalColourDark,newColour,newColourDark){var toggledOn=false;var colour=this.rgbToHex(originalColour);var colourDark=this.rgbToHex(originalColourDark);if(this.rgbToHex(sender.style.backgroundColor)===colour||colour===""||sender.style.backgroundColor===""){colour=this.rgbToHex(newColour);colourDark=this.rgbToHex(newColourDark);toggledOn=true}sender.style.backgroundColor=colour;sender.style.backgroundImage="linear-gradient(to bottom,"+colour+" 0%,"+colourDark+" 100%)";return toggledOn};this.getStyleBySelector=function getStyleBySelector(selector){var sheetList=document.styleSheets;var ruleList;var i,j;for(i=sheetList.length-1;i>=0;i--){ruleList=sheetList[i].cssRules;for(j=0;j<ruleList.length;j++){if(ruleList[j].type==CSSRule.STYLE_RULE&&ruleList[j].selectorText==selector){return ruleList[j].style}}}return null};this.rgbToHex=function rgbToHex(colour){if(colour.charAt(0)==="#"||colour===''){colour=colour.toUpperCase();if(colour.length===3){colour="#0000"+colour.substring(1)}else if(colour.length===5){colour="#00"+colour.substring(1)}return colour}var nums=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(colour),r=parseInt(nums[2],10).toString(16),g=parseInt(nums[3],10).toString(16),b=parseInt(nums[4],10).toString(16);return"#"+((r.length===1?"0"+r:r)+(g.length===1?"0"+g:g)+(b.length===1?"0"+b:b)).toUpperCase()};this.openUploadPage=function openUploadPage(path,fragmentGuid,questionId,uploadType,repeatPath,logGuid,qid){var iframe=$('<iframe width="350px" height="135px" frameborder="0" title="'+$('#uploadPopupTitle').val()+'"/>');$('.modal-insert').html('').append(iframe);$('#popupModal').modal({keyboard:false});path=path+'wizardsupport/SelectFile?FragmentGuid='+fragmentGuid+'&QuestionId='+questionId+'&UploadType='+uploadType+'&repeatPath='+repeatPath+'&logGuid='+logGuid;if(qid!=null&&uploadType==="ink"){path=path+'&qid='+qid}iframe.prop('src',path);this.showingModal()};this.contentUploadFinished=function contentUploadFinished(){_this.closeModal();_this.reload()};this.clearContent=function clearContent(fragmentId,questionId,repeatPath){document.getElementById('custAction').value='clear'+fragmentId+questionId+repeatPath;_this.reload()};this.selectContent=function selectContent(fragmentId,questionId,id,repeatPath){document.getElementById('custAction').value='select'+fragmentId+questionId+repeatPath+'_'+id;_this.reload()};this.searchContent=function searchContent(fragmentId,questionId,repeatPath){document.getElementById('custAction').value='search'+fragmentId+questionId+repeatPath;_this.reload()};this.previewImage=function previewImage(e,id,path,publishedBy){var je=$.event.fix(e);$('#previewWin').html('<img src="'+path+'WizardSupport/GetImage?Thumb=1&Guid='+id+'&publishedBy='+publishedBy+'">');$('#previewWin').css({left:je.pageX,top:je.pageY});$('#previewWin').show()};this.previewClose=function previewClose(){$('#previewWin').hide()};this.delayPostback=function delayPostback(){if(!_this.overridePostback){preventUserInput();timerIdentifier=setTimeout(_this.reload,100)}};this.pageChanged=function pageChanged(){var REPEAT_PAGE_HEADING=-2,NORMAL_PAGE=-1,css,item,repeatList;if(_this.stateCustomUI!==null&&_this.stateCustomUI!==''){var customUIDiv=$('#plhCustomUI');if(customUIDiv.length>0){customUIDiv.html(_this.stateCustomUI)}}if(_this.pageListJson.length===0){if($('.ix-nav-portal').length>0){$('.ix-nav-portal').hide()}$('#ix-pagenavbtn').hide();$('#Sections').hide();$('#Questions').addClass('noNavPane')}else{var pageList=$('#pagesList'),addList=pageList;if(pageList.length>0){var pageUl=$('<ul class="nav">');pageList.html('');pageList.append(pageUl);pageList=pageUl;for(var i=0;i<_this.pageListJson.length;i++){item=_this.pageListJson[i];if(!_this.hasValidationChanged){for(var prevI=0;prevI<previousPageListJson.length;prevI++){if(previousPageListJson[prevI].Index==item.Index&&previousPageListJson[prevI].RepeatIndex==item.RepeatIndex){item.IsValid=previousPageListJson[prevI].IsValid;break}}}if(item.IsValid||item.IsCurrentPage){if(item.RepeatIndex==REPEAT_PAGE_HEADING){css=''}else if(item.IsCurrentPage){css='active g-complete'}else if(item.IsVisited){css='g-complete'}else{css=''}}else{css='g-complete g-error'}if(item.RepeatIndex==REPEAT_PAGE_HEADING){repeatList='';pageList.append($('<li class="'+css+'"><a href="#void" style="cursor:default">'+item.Name+'</a></li>'));if(item.IsSortable){repeatList=$('<ul class="nav sortable touchable" data-pageIndex="'+item.Index+'"></ul>')}else{repeatList=$('<ul class="nav" data-pageIndex="'+item.Index+'"></ul>')}pageList.append(repeatList);addList=repeatList}else if(item.RepeatIndex==NORMAL_PAGE){addList=pageList;addList.append($('<li class="'+css+'"><a href="#void" onclick="wiz.jumpToGroup('+item.Index+', -1);return false;">'+item.Name+'</a></li>'))}else{addList.append($('<li class="'+css+'" data-index="'+item.RepeatIndex+'">'+(item.IsSortable?'<span class="MoveIcon"><span class="sr-only">Move Page</span></span>':'')+'<a href="#void" onclick="wiz.jumpToGroup('+item.Index+', '+item.RepeatIndex+');return false;"><em>&nbsp;&nbsp;&nbsp; '+item.Name+'</em></a></li>'))}}$('.sortable').sortable({update:updateSort})}}previousPageListJson=_this.pageListJson;$('.sortableRow').sortable({items:'> tr',handle:'.touchable',stop:updateSortRow,helper:function(e,ui){$(this).find('.tinyMCE').each(function(){var edId=$(this).prop('id');tinyMCE.editors[edId].remove()});ui.children().each(function(){$(this).width($(this).width())});return ui}}).addTouch();if(_this.pushingState){addHistory()}if(postUpdateCall!==null){postUpdateCall();postUpdateCall=null}attachHelpText()};this.doUserSearch=function doUserSearch(path,groupRestriction,selectString,noPersonFound){$.ajax({type:'POST',contentType:'application/json;charset=utf-8',url:path+'search/users',data:'{"group":"'+groupRestriction+'", "first":"'+$('#firstName').val()+'", "last":"'+$('#lastName').val()+'"}',dataType:'json',success:function(data){var items=[],hasRows=false;$.each(data,function(i,item){if(!item.IsGuest){items.push('<tr><td>'+'<a href="#void" onclick="wiz.selectUser(this, \''+item.Id+'\');return false;" title="'+selectString+'">'+selectString+'</a></td><td>'+item.last+'</td><td>'+item.first+'</td></tr>');hasRows=true}});if(!hasRows){items.push('<tr><td class="cell-normal" colspan="3"><span class="wrn" style="display:inline">'+noPersonFound+'</span></td></tr>')}$('#rowResults').html(items.join(''))}})};this.selectUser=function selectUser(obj,id){var previous=$('#grdResults .active');if(previous.length>0){previous.toggleClass('active')}$(obj).closest('tr').addClass('active');$('#selectedUser').val(id)};this.setPath=function setPath(fragmentGuid,objectId,repeatPath){$('#hidFragmentGuid').val(fragmentGuid);$('#hidObjectId').val(objectId);$('#hidRepeatPath').val(repeatPath);return true};this.fireDefaultButton=function fireDefaultButton(event,button){var je=$.event.fix(event);switch(je.target.type){case'button':return;case'submit':return;case'textarea':return;case'select-one':return;case'':return}if(defaultButtonOverride!==undefined){button=defaultButtonOverride}if(je.which&&je.which==13){if($('#'+button).length>0){_this.overridePostback=true;$('#'+button).click()}return false}return true};this.importComplete=function importComplete(fragmentId,sectionId,repeatPath,maxIndex){document.getElementById('custAction').value='import'+fragmentId+sectionId+repeatPath+'_'+maxIndex;_this.closeModal();_this.reload()};this.setDefaultButton=function setDefaultButton(button){defaultButtonOverride=button};this.dataCheckAll=function dataCheckAll(e){var value,chkBox=e.target||e.srcElement,isChecked=chkBox.checked,grid=$(chkBox).closest('table');if(isChecked){value=''}else{value='None'}document.getElementById(grid.data('selectionfield')).value=value;grid.find('input').prop('checked',isChecked)};this.dataCheckItem=function dataCheckItem(e,index){var chkBox=e.target||e.srcElement,grid=$(chkBox).closest('table'),selectionField=$('#'+grid.data('selectionfield')),selectedIndices,rowCount;if(chkBox.checked){if(selectionField.val()=='None'){selectionField.val(index)}else{selectionField.val(selectionField.val()+','+index)}}else{if(selectionField.val()===''){selectedIndices=[]}else{selectedIndices=selectionField.val().split(',')}if(selectedIndices.length===0){rowCount=grid.find('tr').length;for(var i=0;i<rowCount-1;i++){selectedIndices.push(i.toString())}}this.removeAt(selectedIndices,this.indexOf(selectedIndices,index));if(selectedIndices.length===0){selectedIndices.push('None')}selectionField.val(selectedIndices.join(','))}};this.dataSelectItem=function dataSelectItem(e,index){var aSelect=e.target||e.srcElement,grid=$(aSelect).closest('table'),selectionField=$('#'+grid.data('selectionfield')),row;if(selectionField.val()!==''&&parseInt(selectionField.val(),10)>-1){row=$(grid.find('tr')[parseInt(selectionField.val(),10)+1]);if(row!=null&&row.length>0){row.removeClass('active')}}row=$(aSelect).closest('tr');row.addClass('active');selectionField.val(index)};this.dataScrollToView=function dataScrollToView(grid,container){var frameHalfHeight=90,table=document.getElementById(grid),groups=table.tBodies,selectedRow=null,rows;for(var i=0;i<groups.length;i++){rows=groups[i].rows;for(var j=0;j<rows.length;j++){if(rows[j].getAttribute('class')=='active'){selectedRow=rows[j];break}}}if(selectedRow!==null){$('#'+container).scrollTop(selectedRow.offsetTop-frameHalfHeight)}};this.closeModal=function closeModal(){$('#up').attr("aria-hidden","false");$('#popupModal').modal('hide');var childNodes=$('.modal-insert').children;for(var i=0;i<childNodes.length;i++){$(childNodes[i]).remove()};};this.closeLargeModal=function closeLargeModal(){$('#up').attr("aria-hidden","false");$('#popupLargeModal').modal('hide');var childNodes=$('.modal-lg-insert').children;for(var i=0;i<childNodes.length;i++){$(childNodes[i]).remove()};};this.closeLargeDraggableModal=function closeLargeDraggableModal(){$('#up').attr("aria-hidden","false");$('#popupLargeDraggableModal').modal('hide');var childNodes=$('.modal-lgd-insert').children;for(var i=0;i<childNodes.length;i++){$(childNodes[i]).remove()};};this.closeFullscreenModal=function closeFullscreenModal(){$('#up').attr("aria-hidden","false");$('#popupFullscreenModal').modal('hide');var childNodes=$('.modal-lgf-insert').children;for(var i=0;i<childNodes.length;i++){$(childNodes[i]).remove()};};this.closeWaitDialog=function closeWaitDialog(){if($('#wait-modal').hasClass('in')){$('#wait-modal').modal('hide')}$(document).unbind('keydown');$(document).unbind('mousedown')};this.openImportDialog=function openImportDialog(path,fragmentGuid,objectId,repeatPath,logGuid){var iframe=$('<iframe width="380px" height="260px" frameborder="0" title="'+$('#importPopupTitle').val()+'"/>');$('.modal-insert').html('').append(iframe);$('#popupModal').modal({keyboard:false});iframe.prop('src',path+'WizardSupport/ImportRepeatedItems?fragmentGuid='+fragmentGuid+'&objectid='+objectId+'&repeatpath='+repeatPath+'&logGuid='+logGuid);this.showingModal();return false};function preventUserInput(){$(document).unbind('keydown').bind('keydown',function(event){event.preventDefault()});$(document).unbind('mousedown').bind('mousedown',function(event){event.preventDefault()})}this.doAjaxPost=function doAjaxPost(url,buttonName,buttonValue,restoreFocusTo){var postbackForm=$('#aspnetForm'),formData;beforeSubmit();if(restoreFocusTo!=null){_this.lastFocusedControlId=restoreFocusTo}formData=postbackForm.serialize();if(buttonName!=null){formData+='&'+encodeURIComponent(buttonName)+'='+encodeURIComponent(buttonValue)}$.ajax({type:'POST',url:url,data:formData,error:function(xhr,status,error){if(xhr.status==401){window.location=$('#logUrl').val()}else{updateError(xhr.responseText)}},success:function(response,status,xhr){if(xhr.status==304){_this.overridePostback=false;_this.clearWaitTimer();_this.closeWaitDialog()}else if(xhr.getResponseHeader("X-Responded-JSON")!=null){var jsonResponse=JSON.parse(xhr.getResponseHeader("X-Responded-JSON"));if(jsonResponse.status=="401"){window.location=$('#logUrl').val()}}else{updatePlaceholder(response)}}});if(logoutTimeoutPeriod>0){logoutTimerIdentifier=setTimeout(doLogOut,logoutTimeoutPeriod)}if(liveRefreshPeriod>0){liveRefreshTimerIdentifier=setTimeout(doLiveRefresh,liveRefreshPeriod)}return false};this.clearWaitTimer=function clearWaitTimer(){clearTimeout(waitTimerIdentifier)};this.waitDialogTimerExpired=function waitDialogTimerExpired(){_this.closeModal();_this.closeLargeModal();$('#wait-modal').modal({backdrop:'static',keyboard:false});return false};function renderInkCanvas(id,backgroundBase64,foregroundBase64,colour,canvasWidth,canvasHeight,zoomedIn,dataFocus){var cv=$('#'+id+'cv'),imgBk,img;if(zoomedIn){canvasHeight=window.innerHeight-58;canvasWidth=window.innerWidth-8;var header=$("h3.question-text");header.hide();var sideHeader=$("h3 > div.qtdiv");var td=sideHeader.closest('td');td.remove()}if(backgroundBase64!==null){imgBk=new Image;imgBk.onload=function(){var imgH=imgBk.height;$('#'+id).data('bk-height',imgH);var imgW=imgBk.width;$('#'+id).data('bk-width',imgW);var dispH=imgH;var dispW=imgW;if(canvasHeight>0||canvasWidth>0){var imageRatio=imgH/imgW;var canvas=resizeImgCanvas(canvasHeight,canvasWidth,dispH,dispW,imageRatio);if(canvas.resized){dispH=canvas.height;dispW=canvas.width}}var cvBk=$('#'+id+'cvbk');cvBk.prop('width',dispW).prop('height',dispH);cvBk[0].getContext('2d').drawImage(imgBk,0,0,dispW,dispH);cv.prop('width',dispW).prop('height',dispH);$('#'+id+'wrap').width(dispW).height(dispH);if(zoomedIn){$('#'+id+'scrollwrap').css({height:(dispH*1+14),width:(dispW*1+14),margin:"0 auto"})}else{$('#'+id+'scrollwrap').height(dispH*1+14)}if(zoomedIn){$("#contentinner").css("display","block")}};imgBk.src='data:image/png;base64,'+backgroundBase64}else{$('#'+id+'wrap').width(cv.width()).height(cv.height());$('#'+id+'scrollwrap').width(cv.width()+14).height(cv.height()+14)}if(foregroundBase64!==null){img=new Image;img.onload=function(){var scaleRatio=1;if(backgroundBase64!==null){if(canvasHeight>0||canvasWidth>0){var imageRatio=imgBk.height/imgBk.width;var canvas=resizeImgCanvas(canvasHeight,canvasWidth,imgBk.height,imgBk.width,imageRatio);if(canvas.resized){scaleRatio=canvas.width/imgBk.width}}}var ctx=cv[0].getContext("2d");if(scaleRatio===1){ctx.drawImage(img,0,0)}else{ctx.drawImage(img,0,0,imgBk.width*scaleRatio,imgBk.height*scaleRatio)}};img.src='data:image/png;base64,'+foregroundBase64}cv.on("mouseleave touchend",function(){setInkValue(cv[0])});cv.on("mouseup touchend",function(){if(_this.isCapturingData){_this.dataAnalyticsFocusAndBlur(dataFocus)}})}this.loadInk=function loadInk(id,backgroundBase64,foregroundBase64,colour,canvasWidth,canvasHeight,zoomedIn,dataFocus){var waitTime=0;if(zoomedIn){waitTime=500}window.setTimeout(renderInkCanvas(id,backgroundBase64,foregroundBase64,colour,canvasWidth,canvasHeight,zoomedIn,dataFocus),waitTime)};function resizeImgCanvas(maxHeight,maxWidth,canvasHeight,canvasWidth,imageRatio){var resized=false;if(maxHeight===0&&maxWidth>0&&canvasWidth>maxWidth){canvasWidth=maxWidth;canvasHeight=imageRatio*canvasWidth;resized=true}if(maxWidth===0&&maxHeight>0&&canvasHeight>maxHeight){canvasHeight=maxHeight;canvasWidth=canvasHeight/imageRatio;resized=true}if((maxWidth>0&&canvasWidth>maxWidth)||(maxHeight>0&&canvasHeight>maxHeight)){canvasHeight=maxHeight;canvasWidth=canvasHeight/imageRatio;if(canvasWidth>maxWidth){canvasWidth=maxWidth;canvasHeight=imageRatio*canvasWidth}resized=true}return{resized:resized,width:canvasWidth,height:canvasHeight}}this.clearInk=function clearInk(id){var canvas=$('#'+id+'cv')[0],ctx=canvas.getContext('2d');ctx.clearRect(0,0,canvas.width,canvas.height);$('#'+id).val('')};this.eraseInk=function clearInk(id){var canvas=$('#'+id+'cv')[0],ctx=canvas.getContext('2d');if(ctx.globalCompositeOperation==="destination-out"){ctx.globalCompositeOperation="source-over";$('#'+id+'btn').removeClass("active")}else{ctx.globalCompositeOperation="destination-out";$('#'+id+'btn').addClass("active")}};this.setInkColor=function setInkColor(id,colour,signaturePad){var canvas=$('#'+id+'cv')[0],ctx=canvas.getContext('2d');ctx.fillStyle=colour;signaturePad.penColor=colour};this.wireTextChanged=function wireTextChanged(textId,changeId,clearDefault){$(textId).on('change',function(){$(changeId).val('1')});$(textId).on('keydown',function(e){var code=e.keyCode||e.which;if(code!='9'&&code!='16'){if(code!='13'&&clearDefault!==''){if($(textId).val()==clearDefault){$(textId).val('')}}}})};var removeCurrencyFormat=function removeCurrencyFormat(value,currencySymbol,decimalSymbol){value=value.replace(currencySymbol,'');return value.replace(new RegExp('[^0-9\\-\\'+decimalSymbol+']+','g'),'')};this.removeFormat=function removeFormat(txt,currencySymbol,decimalSymbol){txt.value=removeCurrencyFormat(txt.value,currencySymbol,decimalSymbol)};this.applyFormat=function applyFormat(path,txt,currencySymbol,decimalSymbol,positivePattern,negativePattern,decimalPlaces){var textValue=removeCurrencyFormat(txt.value,currencySymbol,decimalSymbol);if(textValue!==''){$.ajax({type:'POST',contentType:'application/json;charset=utf-8',url:path+'wizardsupport/formatcurrency',data:'{"value":"'+textValue+'", "symbol":"'+currencySymbol+'", "positivePattern":"'+positivePattern+'", "negativePattern":"'+negativePattern+'", "decimalPlaces":"'+decimalPlaces+'"}',dataType:'json',success:function(data){txt.value=data}})}};this.initWizard=function initWizard(){if(window.History&&History.Adapter){History.Adapter.bind(window,'statechange',function(){var State=History.getState();if(!_this.pushingState){if(State.data!=null&&State.data.p!=null){document.getElementById('hidNextGroup').value=State.data.p;document.getElementById('hidNextRepeatIndex').value=State.data.r;_this.reload()}else{History.back()}}_this.pushingState=false})}$(window).on('beforeunload',function(e){if(_this.isCapturingData){_this.dataAnalyticsBlur();_this.postDataCapture(true)}if(_this.formIsDirty){return $('#exitMessage').val()}});$(document).on('hide.bs.dropdown','.btn-group-multiselect',function(){wiz.reload()})};this.bodyClick=function bodyClick(){if($(".navbar-collapse").is(":visible")&&$(".navbar-toggle").is(":visible")){$('.navbar-collapse').collapse('toggle')}};this.showingModal=function(){$('#up').attr("aria-hidden","true")};this.disableWeekends=function disableWeekends(date){var day=date.getDay();for(var i=0;i<2;i++){if($.inArray(day,[0,6])!=-1){return[false]}}return[true]}};function triggerRefresh(){'use strict';document.getElementById('hidValidate').value=true;wiz.delayPostback()}